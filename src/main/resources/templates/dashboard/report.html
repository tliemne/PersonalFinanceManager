<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
  /*<![CDATA[*/
  const transactions = /*[[${transactions}]]*/ [];

  if (transactions && transactions.length > 0) {
    // ðŸ”¹ PhÃ¢n loáº¡i giao dá»‹ch
    const expenseData = transactions.filter(t => t.transactionType === 'EXPENSE');
    const incomeData = transactions.filter(t => t.transactionType === 'INCOME');

    // ðŸ”¹ Gom chi tiÃªu theo category
    const expenseByCategory = {};
    expenseData.forEach(t => {
      const category = t.categoryName || 'KhÃ¡c'; // âœ… DTO cÃ³ sáºµn categoryName
      expenseByCategory[category] = (expenseByCategory[category] || 0) + t.amount;
    });

    // ðŸ”¹ Gom thu nháº­p theo thÃ¡ng
    const incomeByMonth = {};
    incomeData.forEach(t => {
      const date = new Date(t.transactionDate);
      const month = date.toLocaleString('default', { month: 'short', year: 'numeric' });
      incomeByMonth[month] = (incomeByMonth[month] || 0) + t.amount;
    });

    // ðŸ¥§ Biá»ƒu Ä‘á»“ chi tiÃªu theo danh má»¥c
    const expenseChart = document.getElementById("expenseChart");
    if (expenseChart) {
      new Chart(expenseChart, {
        type: 'pie',
        data: {
          labels: Object.keys(expenseByCategory),
          datasets: [{
            data: Object.values(expenseByCategory),
            backgroundColor: ['#FF6384', '#FF9F40', '#FFCD56', '#4BC0C0', '#36A2EB', '#9966FF']
          }]
        },
        options: {
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    // ðŸ“Š Biá»ƒu Ä‘á»“ thu nháº­p theo thÃ¡ng
    const incomeChart = document.getElementById("incomeChart");
    if (incomeChart) {
      new Chart(incomeChart, {
        type: 'bar',
        data: {
          labels: Object.keys(incomeByMonth),
          datasets: [{
            label: 'Thu nháº­p',
            data: Object.values(incomeByMonth),
            backgroundColor: '#4CAF50'
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } },
          plugins: { legend: { display: false } }
        }
      });
    }
  }
  /*]]>*/
</script>
