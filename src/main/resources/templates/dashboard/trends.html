<!-- templates/dashboard/trends.html -->
<div th:fragment="content" class="p-6 space-y-8 animate-fade-in">

  <!-- üßæ Ti√™u ƒë·ªÅ -->
  <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-800 mb-1 flex items-center gap-2">
        <i class="fa-solid fa-chart-line text-indigo-600"></i>
        Xu h∆∞·ªõng chi ti√™u
      </h1>
      <p class="text-gray-500">Ph√¢n t√≠ch xu h∆∞·ªõng chi ti√™u theo th·ªùi gian v√† danh m·ª•c</p>
    </div>
  </div>

  <!-- üß≠ B·ªô l·ªçc th·ªùi gian -->
  <form th:action="@{/dashboard/trends}" method="get"
        class="bg-white p-5 rounded-2xl shadow flex flex-wrap items-end gap-4 border border-gray-100 max-w-3xl">
    <div class="flex flex-col">
      <label for="startDate" class="text-sm font-medium text-gray-600 mb-1">T·ª´ ng√†y</label>
      <input id="startDate" name="startDate" type="date"
             th:value="${#temporals.format(startDate, 'yyyy-MM-dd')}"
             class="border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 outline-none transition">
    </div>
    <div class="flex flex-col">
      <label for="endDate" class="text-sm font-medium text-gray-600 mb-1">ƒê·∫øn ng√†y</label>
      <input id="endDate" name="endDate" type="date"
             th:value="${#temporals.format(endDate, 'yyyy-MM-dd')}"
             class="border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 outline-none transition">
    </div>
    <button type="submit"
            class="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2.5 rounded-xl shadow transition flex items-center gap-2">
      <i class="fa-solid fa-filter"></i>
      <span>L·ªçc d·ªØ li·ªáu</span>
    </button>
  </form>

  <!-- üìä Bi·ªÉu ƒë·ªì -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">

    <!-- üìÜ Chi ti√™u theo ng√†y -->
    <div class="bg-white p-5 rounded-2xl shadow border border-gray-100 hover:shadow-lg transition w-full">
      <h2 class="text-base font-semibold text-gray-700 mb-3 flex items-center gap-2">
        <i class="fa-solid fa-calendar-day text-indigo-500"></i>
        Chi ti√™u theo ng√†y
      </h2>
      <div class="relative w-full h-[300px]">
        <canvas id="chartByDay"></canvas>
      </div>
    </div>

    <!-- üè∑Ô∏è Chi ti√™u theo danh m·ª•c -->
    <div class="bg-white p-5 rounded-2xl shadow border border-gray-100 hover:shadow-lg transition w-full">
      <h2 class="text-base font-semibold text-gray-700 mb-3 flex items-center gap-2">
        <i class="fa-solid fa-tags text-emerald-500"></i>
        Chi ti√™u theo danh m·ª•c
      </h2>
      <div class="relative w-full h-[300px]">
        <canvas id="chartByCategory"></canvas>
      </div>
    </div>

    <!-- üìÖ Chi ti√™u theo th√°ng -->
    <div class="bg-white p-5 rounded-2xl shadow border border-gray-100 hover:shadow-lg transition xl:col-span-2 w-full">
      <h2 class="text-base font-semibold text-gray-700 mb-3 flex items-center gap-2">
        <i class="fa-solid fa-calendar-alt text-pink-500"></i>
        Chi ti√™u theo th√°ng
      </h2>
      <div class="relative w-full h-[320px]">
        <canvas id="chartByMonth"></canvas>
      </div>
    </div>

  </div>

  <!-- ‚öôÔ∏è Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- üìà Render d·ªØ li·ªáu -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    const trends = /*[[${trends}]]*/ {};

    const chartDefaults = {
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { display: false } }
      }
    };

    // üìÜ Theo ng√†y
    new Chart(document.getElementById('chartByDay'), {
      type: 'line',
      data: {
        labels: Object.keys(trends.expenseByDay || {}),
        datasets: [{
          data: Object.values(trends.expenseByDay || {}),
          borderColor: '#6366F1',
          backgroundColor: 'rgba(99,102,241,0.2)',
          borderWidth: 2,
          tension: 0.4,
          fill: true
        }]
      },
      ...chartDefaults
    });

    // üè∑Ô∏è Theo danh m·ª•c
    new Chart(document.getElementById('chartByCategory'), {
      type: 'bar',
      data: {
        labels: Object.keys(trends.expenseByCategory || {}),
        datasets: [{
          data: Object.values(trends.expenseByCategory || {}),
          backgroundColor: ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'],
          borderRadius: 6
        }]
      },
      ...chartDefaults
    });

    // üìÖ Theo th√°ng
    new Chart(document.getElementById('chartByMonth'), {
      type: 'bar',
      data: {
        labels: Object.keys(trends.expenseByMonth || {}),
        datasets: [{
          data: Object.values(trends.expenseByMonth || {}),
          backgroundColor: 'rgba(236,72,153,0.7)',
          borderRadius: 6
        }]
      },
      ...chartDefaults
    });
    /*]]>*/
  </script>

</div>
