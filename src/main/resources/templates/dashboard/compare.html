<!-- templates/dashboard/compare.html -->
<div th:fragment="content" class="p-6 space-y-10 animate-fade-in">

    <!-- üßæ Ti√™u ƒë·ªÅ -->
    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-800 mb-1 flex items-center gap-2">
                <i class="fa-solid fa-chart-column text-indigo-600"></i>
                So s√°nh chi ti√™u theo th√°ng & nƒÉm
            </h1>
            <p class="text-gray-500">Theo d√µi bi·∫øn ƒë·ªông thu nh·∫≠p v√† chi ti√™u qua th·ªùi gian</p>
        </div>
    </div>

    <!-- üîπ Bi·ªÉu ƒë·ªì 1: So s√°nh theo th√°ng -->
    <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 hover:shadow-lg transition">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-calendar-alt text-emerald-500"></i>
            So s√°nh 6 th√°ng g·∫ßn nh·∫•t
        </h3>
        <div class="relative w-full max-w-4xl mx-auto h-[320px]">
            <canvas id="monthlyCompareChart"></canvas>
        </div>
    </div>

    <!-- üîπ Bi·ªÉu ƒë·ªì 2: So s√°nh theo nƒÉm -->
    <div class="bg-white rounded-2xl shadow border border-gray-100 p-6 hover:shadow-lg transition">
        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
            <i class="fa-solid fa-calendar text-pink-500"></i>
            So s√°nh gi·ªØa c√°c nƒÉm
        </h3>
        <div class="relative w-full max-w-4xl mx-auto h-[280px]">
            <canvas id="yearlyCompareChart"></canvas>
        </div>
    </div>

</div>

<!-- üìà Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ‚úÖ D·ªØ li·ªáu JSON t·ª´ controller -->
<script th:inline="javascript">
    /*<![CDATA[*/
        const compareData = JSON.parse(/*[[${compareDataJson}]]*/ '{}');
        console.log("Compare Data:", compareData);

        // B·∫£o v·ªá tr√°nh null
        const incomeByMonth = compareData.incomeByMonth || {};
        const expenseByMonth = compareData.expenseByMonth || {};
        const incomeCompare = compareData.incomeCompare || {};
        const expenseCompare = compareData.expenseCompare || {};

        /* --- Bi·ªÉu ƒë·ªì theo th√°ng --- */
        const monthLabels = Object.keys(incomeByMonth);
        const incomeValues = Object.values(incomeByMonth);
        const expenseValues = Object.values(expenseByMonth);

        new Chart(document.getElementById("monthlyCompareChart"), {
          type: "bar",
          data: {
            labels: monthLabels,
            datasets: [
              {
                label: "Thu nh·∫≠p",
                data: incomeValues,
                backgroundColor: "rgba(16, 185, 129, 0.7)", // emerald-500
                borderRadius: 6,
              },
              {
                label: "Chi ti√™u",
                data: expenseValues,
                backgroundColor: "rgba(239, 68, 68, 0.7)", // red-500
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: "top" },
              tooltip: {
                callbacks: {
                  label: ctx => `${ctx.dataset.label}: ${ctx.formattedValue} ‚Ç´`
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: value => value.toLocaleString("vi-VN") + " ‚Ç´"
                }
              }
            },
          },
        });

        /* --- Bi·ªÉu ƒë·ªì theo nƒÉm --- */
        const yearLabels = Object.keys(incomeCompare);
        const incomeYearValues = Object.values(incomeCompare);
        const expenseYearValues = Object.values(expenseCompare);

        new Chart(document.getElementById("yearlyCompareChart"), {
          type: "bar",
          data: {
            labels: yearLabels,
            datasets: [
              {
                label: "Thu nh·∫≠p",
                data: incomeYearValues,
                backgroundColor: "rgba(52, 211, 153, 0.8)",
                borderRadius: 6,
              },
              {
                label: "Chi ti√™u",
                data: expenseYearValues,
                backgroundColor: "rgba(248, 113, 113, 0.8)",
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: "top" },
              tooltip: {
                callbacks: {
                  label: ctx => `${ctx.dataset.label}: ${ctx.formattedValue} ‚Ç´`
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: value => value.toLocaleString("vi-VN") + " ‚Ç´"
                }
              }
            },
          },
        });
    /*]]>*/
</script>
