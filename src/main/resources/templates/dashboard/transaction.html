<!-- templates/dashboard/transaction.html -->
<div th:fragment="content">

    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">üíº Qu·∫£n l√Ω giao d·ªãch</h1>
        <p class="text-gray-500">Xem, th√™m, ch·ªânh s·ª≠a v√† kh√¥i ph·ª•c giao d·ªãch</p>
    </div>

    <!-- DANH S√ÅCH GIAO D·ªäCH -->
    <section class="bg-white p-6 rounded-2xl shadow mb-10" id="list">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Danh s√°ch giao d·ªãch</h2>
            <div class="space-x-2">
                <button type="button" onclick="openModal('formModal')"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
                    ‚ûï Th√™m giao d·ªãch
                </button>
                <button type="button" onclick="openModal('trashModal')"
                        class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600">
                    üóëÔ∏è Th√πng r√°c
                </button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full border border-gray-200">
                <thead class="bg-gray-100 text-gray-700">
                <tr>
                    <th class="py-2 px-3 border">ID</th>
                    <th class="py-2 px-3 border">Lo·∫°i</th>
                    <th class="py-2 px-3 border">Danh m·ª•c</th>
                    <th class="py-2 px-3 border">S·ªë ti·ªÅn</th>
                    <th class="py-2 px-3 border">Tr·∫°ng th√°i</th>
                    <th class="py-2 px-3 border">Ng√†y</th>
                    <th class="py-2 px-3 border">M√¥ t·∫£</th>
                    <th class="py-2 px-3 border">H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="t : ${transactions}">
                    <td th:text="${t.id}" class="py-2 px-3 border"></td>
                    <td th:text="${t.transactionType}" class="py-2 px-3 border"></td>
                    <td th:text="${t.categoryName}" class="py-2 px-3 border"></td>
                    <td th:text="${#numbers.formatDecimal(t.amount, 0, 'COMMA', 2, 'POINT') + ' ‚Ç´'}"
                        class="py-2 px-3 border text-right"></td>
                    <td th:text="${t.status}" class="py-2 px-3 border"></td>
                    <td th:text="${#temporals.format(t.transactionDate, 'dd/MM/yyyy')}" class="py-2 px-3 border"></td>
                    <td th:text="${t.description}" class="py-2 px-3 border"></td>
                    <td class="py-2 px-3 border space-x-2 text-center">
                        <a th:href="@{'/dashboard/transaction/delete/' + ${t.id}}"
                           class="text-red-600 hover:underline"
                           onclick="return confirm('Chuy·ªÉn giao d·ªãch n√†y v√†o th√πng r√°c?')">üóëÔ∏è</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(transactions)}">
                    <td colspan="8" class="text-center py-4 text-gray-500">Kh√¥ng c√≥ giao d·ªãch n√†o</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- MODAL: FORM TH√äM/S·ª¨A -->
    <div id="formModal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg relative overflow-y-auto max-h-[85vh]">

        <button type="button" onclick="closeModal('formModal')" class="absolute top-2 right-3 text-gray-500 text-2xl">&times;</button>

            <h2 class="text-xl font-semibold mb-4"
                th:text="${transactionDto.id != null} ? '‚úèÔ∏è Ch·ªânh s·ª≠a giao d·ªãch' : '‚ûï Th√™m giao d·ªãch m·ªõi'"></h2>

            <form th:action="@{/dashboard/transaction/save}" th:object="${transactionDto}" method="post" class="space-y-4">
                <input type="hidden" th:field="*{id}" />

                <div>
                    <label class="block text-gray-600 mb-1">Lo·∫°i giao d·ªãch</label>
                    <select th:field="*{transactionType}" class="border rounded-md p-2 w-full">
                        <option value="INCOME">Thu nh·∫≠p</option>
                        <option value="EXPENSE">Chi ti√™u</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-600 mb-1">T√†i kho·∫£n</label>
                    <select th:field="*{accountId}" class="border rounded-md p-2 w-full">
                        <option value="">-- Ch·ªçn t√†i kho·∫£n --</option>
                        <option th:each="a : ${accounts}" th:value="${a.id}" th:text="${a.name}"></option>
                    </select>
                </div>


                <div>
                    <label class="block text-gray-600 mb-1">Danh m·ª•c</label>
                    <select th:field="*{categoryId}" class="border rounded-md p-2 w-full">
                        <option th:each="c : ${categories}" th:value="${c.id}" th:text="${c.name}"></option>
                    </select>
                </div>

                <div>
                    <label class="block text-gray-600 mb-1">S·ªë ti·ªÅn</label>
                    <input type="number" step="0.01" th:field="*{amount}" class="border rounded-md p-2 w-full"/>
                </div>

                <div>
                    <label class="block text-gray-600 mb-1">Tr·∫°ng th√°i</label>
                    <select th:field="*{status}" class="border rounded-md p-2 w-full">
                        <option value="PENDING">ƒêang x·ª≠ l√Ω</option>
                        <option value="COMPLETED">Ho√†n th√†nh</option>
                        <option value="CANCELLED">H·ªßy b·ªè</option>
                    </select>
                </div>

                <div>
                    <label class="block text-gray-600 mb-1">Ng√†y giao d·ªãch</label>
                    <input type="date" th:field="*{transactionDate}" class="border rounded-md p-2 w-full"/>
                </div>

                <div>
                    <label class="block text-gray-600 mb-1">M√¥ t·∫£</label>
                    <textarea th:field="*{description}" class="border rounded-md p-2 w-full" rows="3"></textarea>
                </div>

                <div class="pt-3 flex justify-end">
                    <button type="button" onclick="closeModal('formModal')" class="mr-3 text-gray-600 hover:underline">H·ªßy</button>
                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">üíæ L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: TH√ôNG R√ÅC -->
    <div id="trashModal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-4xl relative overflow-y-auto max-h-[80vh]">
            <button type="button" onclick="closeModal('trashModal')" class="absolute top-2 right-3 text-gray-500 text-2xl">&times;</button>
            <h2 class="text-xl font-semibold mb-4">üóëÔ∏è Giao d·ªãch ƒë√£ x√≥a</h2>

            <table class="min-w-full border border-gray-200">
                <thead class="bg-gray-100 text-gray-700">
                <tr>
                    <th class="py-2 px-3 border">ID</th>
                    <th class="py-2 px-3 border">Lo·∫°i</th>
                    <th class="py-2 px-3 border">Danh m·ª•c</th>
                    <th class="py-2 px-3 border">S·ªë ti·ªÅn</th>
                    <th class="py-2 px-3 border">Ng√†y</th>
                    <th class="py-2 px-3 border">M√¥ t·∫£</th>
                    <th class="py-2 px-3 border">H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="t : ${deletedTransactions}">
                    <td th:text="${t.id}" class="py-2 px-3 border"></td>
                    <td th:text="${t.transactionType}" class="py-2 px-3 border"></td>
                    <td th:text="${t.categoryName}" class="py-2 px-3 border"></td>
                    <td th:text="${t.amount}" class="py-2 px-3 border"></td>
                    <td th:text="${#temporals.format(t.transactionDate, 'dd/MM/yyyy')}" class="py-2 px-3 border"></td>
                    <td th:text="${t.description}" class="py-2 px-3 border"></td>
                    <td class="py-2 px-3 border text-center space-x-2">
                        <a th:href="@{'/dashboard/transaction/restore/' + ${t.id}}" class="text-green-600 hover:underline">‚ôªÔ∏è</a>
                        <a th:href="@{'/dashboard/transaction/permanent-delete/' + ${t.id}}"
                           class="text-red-600 hover:underline"
                           onclick="return confirm('X√≥a vƒ©nh vi·ªÖn giao d·ªãch n√†y?')">‚ùå</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(deletedTransactions)}">
                    <td colspan="7" class="text-center py-4 text-gray-500">Kh√¥ng c√≥ giao d·ªãch ƒë√£ x√≥a</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function openModal(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }
    </script>

</div>
