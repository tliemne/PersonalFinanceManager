<!-- templates/layout/fragments/sidebar.html -->
<nav th:fragment="sidebar"
     class="flex h-screen w-64 flex-col bg-white text-gray-800 border-r transition-all duration-300">

  <div class="px-6 py-6 overflow-auto flex-1">

    <!-- Logo -->
    <div class="flex items-center gap-3 mb-8">
      <div class="h-10 w-10 rounded-md bg-gradient-to-br from-indigo-500 to-blue-400 flex items-center justify-center text-white shadow">
        <i class="fas fa-coins text-lg"></i>
      </div>
      <div>
        <div class="font-bold text-lg">FinancePro</div>
        <div class="text-xs text-gray-400">Quản lý tài chính</div>
      </div>
    </div>

    <!-- ========== Tổng quan ========== -->
    <div class="mb-5">
      <button data-target="group-overview"
              class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
              aria-expanded="true">
        <div class="flex items-center gap-3">
          <i class="fas fa-layer-group w-4"></i>
          <span class="font-medium">Tổng quan</span>
        </div>
        <i class="fas fa-chevron-down transition-transform collapse-arrow rotate-180"></i>
      </button>

      <div id="group-overview" class="mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
        <a th:href="@{/dashboard}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'dashboard'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-chart-pie w-4"></i>
          <span>Dashboard</span>
        </a>
        <a th:href="@{/dashboard/analysis}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'analysis'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-bolt w-4"></i>
          <span>Phân tích nhanh</span>
        </a>
      </div>
    </div>

    <!-- ========== Quản lý tài chính ========== -->
    <div class="mb-5">
      <button data-target="group-finance"
              class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
              aria-expanded="false">
        <div class="flex items-center gap-3">
          <i class="fas fa-wallet w-4"></i>
          <span class="font-medium">Quản lý tài chính</span>
        </div>
        <i class="fas fa-chevron-down transition-transform collapse-arrow"></i>
      </button>

      <div id="group-finance" class="hidden mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
        <a th:href="@{/dashboard/budget}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'budget'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-piggy-bank w-4"></i><span>Ngân sách</span>
        </a>
        <a th:href="@{/dashboard/transaction}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'transaction'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-exchange-alt w-4"></i><span>Giao dịch</span>
        </a>
        <a th:href="@{/dashboard/category}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'category'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-tags w-4"></i><span>Danh mục</span>
        </a>
        <a th:href="@{/dashboard/wallet}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'wallet'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-university w-4"></i><span>Ví / Tài khoản ngân hàng</span>
        </a>
        <a th:href="@{/dashboard/debt}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'debt'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-hand-holding-usd w-4"></i><span>Khoản vay / Nợ</span>
        </a>
        <a th:href="@{/dashboard/investment}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'investment'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-chart-bar w-4"></i><span>Đầu tư</span>
        </a>
        <a th:href="@{/dashboard/goal}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'goal'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-bullseye w-4"></i><span>Mục tiêu tài chính</span>
        </a>
      </div>
    </div>

    <!-- ========== Báo cáo & Phân tích ========== -->
    <div class="mb-5">
      <button data-target="group-report"
              class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
              aria-expanded="false">
        <div class="flex items-center gap-3">
          <i class="fas fa-chart-line w-4"></i>
          <span class="font-medium">Báo cáo & Phân tích</span>
        </div>
        <i class="fas fa-chevron-down transition-transform collapse-arrow"></i>
      </button>

      <div id="group-report" class="hidden mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
        <a th:href="@{/dashboard/report}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'report'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-file-alt w-4"></i><span>Báo cáo tổng hợp</span>
        </a>
        <a th:href="@{/dashboard/trends}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'trends'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-wave-square w-4"></i><span>Xu hướng chi tiêu</span>
        </a>
        <a th:href="@{/dashboard/compare}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
           th:classappend="${activePage == 'compare'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
          <i class="fas fa-balance-scale w-4"></i><span>So sánh tháng / năm</span>
        </a>
      </div>
    </div>

    <!-- ========== Người dùng & Hệ thống ========== -->
    <div class="mb-5">
      <button data-target="group-user"
              class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
              aria-expanded="false">
        <div class="flex items-center gap-3">
          <i class="fas fa-user-cog w-4"></i>
          <span class="font-medium">Người dùng & Hệ thống</span>
        </div>
        <i class="fas fa-chevron-down transition-transform collapse-arrow"></i>
      </button>

      <div id="group-user" class="hidden mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
        <a th:href="@{/dashboard/profile}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
          <i class="fas fa-id-card w-4"></i><span>Hồ sơ cá nhân</span>
        </a>
        <a th:href="@{/dashboard/settings}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
          <i class="fas fa-cogs w-4"></i><span>Cài đặt</span>
        </a>
        <a th:href="@{/dashboard/security}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
          <i class="fas fa-lock w-4"></i><span>Bảo mật</span>
        </a>
        <a th:href="@{/dashboard/help}"
           class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
          <i class="fas fa-life-ring w-4"></i><span>Trung tâm hỗ trợ</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="px-6 py-4 border-t flex items-center justify-between">
    <button id="theme-toggle" class="flex items-center gap-2 text-gray-600 hover:text-indigo-600 transition">
      <i class="fas fa-moon"></i>
      <span>Chế độ tối</span>
    </button>
    <a th:href="@{/logout}" class="text-gray-600 hover:text-red-600 flex items-center gap-2 transition">
      <i class="fas fa-sign-out-alt"></i>
      <span>Đăng xuất</span>
    </a>
  </div>
</nav>

<!-- ========== JS Collapse ========== -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const collapseBtns = document.querySelectorAll('.collapse-btn');

    collapseBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = document.getElementById(btn.dataset.target);
        const expanded = btn.getAttribute('aria-expanded') === 'true';

        collapseBtns.forEach(other => {
          if (other !== btn) {
            const t = document.getElementById(other.dataset.target);
            t.classList.add('hidden');
            other.setAttribute('aria-expanded', 'false');
            other.querySelector('.collapse-arrow').classList.remove('rotate-180');
          }
        });

        btn.setAttribute('aria-expanded', !expanded);
        btn.querySelector('.collapse-arrow').classList.toggle('rotate-180', !expanded);
        target.classList.toggle('hidden', expanded);
      });
    });
  });
</script>
