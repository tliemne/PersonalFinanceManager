  <!-- templates/layout/fragments/sidebar.html -->
  <nav th:fragment="sidebar"
       class="flex h-screen w-64 flex-col bg-white text-gray-800 border-r transition-all duration-300">

    <div class="px-6 py-6 overflow-auto flex-1">

      <!-- Logo -->
      <div class="flex items-center gap-3 mb-8">
        <div class="h-10 w-10 rounded-md bg-gradient-to-br from-indigo-500 to-blue-400 flex items-center justify-center text-white shadow">
          <i class="fas fa-coins text-lg"></i>
        </div>
        <div>
          <div class="font-bold text-lg">FinancePro</div>
          <div class="text-xs text-gray-400">Qu·∫£n l√Ω t√†i ch√≠nh</div>
        </div>
      </div>

      <!-- ========== T·ªïng quan ========== -->
      <div class="mb-5">
        <button data-target="group-overview"
                class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
                aria-expanded="true">
          <div class="flex items-center gap-3">
            <i class="fas fa-layer-group w-4"></i>
            <span class="font-medium">T·ªïng quan</span>
          </div>
          <i class="fas fa-chevron-down transition-transform collapse-arrow rotate-180"></i>
        </button>

        <div id="group-overview" class="mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
          <a th:href="@{/dashboard}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'dashboard'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-chart-pie w-4"></i>
            <span>Dashboard</span>
          </a>
          <a th:href="@{/dashboard/analysis}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'analysis'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-bolt w-4"></i>
            <span>Ph√¢n t√≠ch nhanh</span>
          </a>
        </div>
      </div>

      <!-- ========== Qu·∫£n l√Ω t√†i ch√≠nh ========== -->
      <div class="mb-5">
        <button data-target="group-finance"
                class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
                aria-expanded="false">
          <div class="flex items-center gap-3">
            <i class="fas fa-wallet w-4"></i>
            <span class="font-medium">Qu·∫£n l√Ω t√†i ch√≠nh</span>
          </div>
          <i class="fas fa-chevron-down transition-transform collapse-arrow"></i>
        </button>

        <div id="group-finance" class="hidden mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
          <a th:href="@{/dashboard/budget}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'budget'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-piggy-bank w-4"></i><span>Ng√¢n s√°ch</span>
          </a>
          <a th:href="@{/dashboard/transaction}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'transaction'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-exchange-alt w-4"></i><span>Giao d·ªãch</span>
          </a>
          <a th:href="@{/dashboard/category}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'category'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-tags w-4"></i><span>Danh m·ª•c</span>
          </a>
          <a th:href="@{/dashboard/accounts}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'accounts'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-university w-4"></i><span>V√≠ / T√†i kho·∫£n ng√¢n h√†ng</span>
          </a>
<!--          <a th:href="@{/dashboard/debt}"-->
<!--             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"-->
<!--             th:classappend="${activePage == 'debt'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">-->
<!--            <i class="fas fa-hand-holding-usd w-4"></i><span>Kho·∫£n vay / N·ª£</span>-->
<!--          </a>-->
<!--          <a th:href="@{/dashboard/investment}"-->
<!--             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"-->
<!--             th:classappend="${activePage == 'investment'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">-->
<!--            <i class="fas fa-chart-bar w-4"></i><span>ƒê·∫ßu t∆∞</span>-->
<!--          </a>-->
          <a th:href="@{/dashboard/goals}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'goals'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-bullseye w-4"></i><span>M·ª•c ti√™u t√†i ch√≠nh</span>
          </a>
        </div>
      </div>

      <!-- ========== B√°o c√°o & Ph√¢n t√≠ch ========== -->
      <div class="mb-5">
        <button data-target="group-report"
                class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
                aria-expanded="false">
          <div class="flex items-center gap-3">
            <i class="fas fa-chart-line w-4"></i>
            <span class="font-medium">B√°o c√°o & Ph√¢n t√≠ch</span>
          </div>
          <i class="fas fa-chevron-down transition-transform collapse-arrow"></i>
        </button>

        <div id="group-report" class="hidden mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
<!--          <a th:href="@{/dashboard/report}"-->
<!--             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"-->
<!--             th:classappend="${activePage == 'report'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">-->
<!--            <i class="fas fa-file-alt w-4"></i><span>B√°o c√°o t·ªïng h·ª£p</span>-->
<!--          </a>-->
          <a th:href="@{/dashboard/trends}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'trends'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-wave-square w-4"></i><span>Xu h∆∞·ªõng chi ti√™u</span>
          </a>
          <a th:href="@{/dashboard/compare}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition"
             th:classappend="${activePage == 'compare'} ? ' bg-gradient-to-r from-indigo-500 to-blue-400 text-white shadow font-medium' : ''">
            <i class="fas fa-balance-scale w-4"></i><span>So s√°nh th√°ng / nƒÉm</span>
          </a>
        </div>
      </div>

      <!-- ========== Ng∆∞·ªùi d√πng & H·ªá th·ªëng ========== -->
      <div class="mb-5">
        <button data-target="group-user"
                class="w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 collapse-btn"
                aria-expanded="false">
          <div class="flex items-center gap-3">
            <i class="fas fa-user-cog w-4"></i>
            <span class="font-medium">Ng∆∞·ªùi d√πng & H·ªá th·ªëng</span>
          </div>
          <i class="fas fa-chevron-down transition-transform collapse-arrow"></i>
        </button>

        <div id="group-user" class="hidden mt-2 pl-6 space-y-1 transition-all duration-300 ease-in-out">
          <a th:href="@{/dashboard/profile}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
            <i class="fas fa-id-card w-4"></i><span>H·ªì s∆° c√° nh√¢n</span>
          </a>
          <a th:href="@{/dashboard/settings}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
            <i class="fas fa-cogs w-4"></i><span>C√†i ƒë·∫∑t</span>
          </a>
          <a th:href="@{/dashboard/security}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
            <i class="fas fa-lock w-4"></i><span>B·∫£o m·∫≠t</span>
          </a>
          <a th:href="@{/dashboard/help}"
             class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition">
            <i class="fas fa-life-ring w-4"></i><span>Trung t√¢m h·ªó tr·ª£</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 border-t flex items-center justify-between">
      <button id="theme-toggle" class="flex items-center gap-2 text-gray-600 hover:text-indigo-600 transition">
        <i class="fas fa-moon"></i>
        <span>Ch·∫ø ƒë·ªô t·ªëi</span>
      </button>
      <a th:href="@{/logout}" class="text-gray-600 hover:text-red-600 flex items-center gap-2 transition">
        <i class="fas fa-sign-out-alt"></i>
        <span>ƒêƒÉng xu·∫•t</span>
      </a>
    </div>
  </nav>

  <!-- ========== JS Collapse ========== -->
  <!-- ========== JS Collapse (Fixed + Remember State) ========== -->
  <!-- ========== JS Collapse (Fixed + Remember State + Auto Expand Active) ========== -->
  <!-- ========== JS Collapse (Fixed + Remember State + Auto Expand Active) ========== -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const collapseBtns = document.querySelectorAll('.collapse-btn');

      // --- 1Ô∏è‚É£ Kh√¥i ph·ª•c tr·∫°ng th√°i m·ªü/ƒë√≥ng t·ª´ localStorage ---
      collapseBtns.forEach(btn => {
        const targetId = btn.dataset.target;
        const target = document.getElementById(targetId);
        const isOpen = localStorage.getItem(`sidebar-${targetId}`) === 'true';

        btn.setAttribute('aria-expanded', isOpen);
        target.classList.toggle('hidden', !isOpen);
        btn.querySelector('.collapse-arrow').classList.toggle('rotate-180', isOpen);
      });

      // --- 2Ô∏è‚É£ Toggle khi click ---
      collapseBtns.forEach(btn => {
        btn.addEventListener('click', e => {
          e.preventDefault();
          const targetId = btn.dataset.target;
          const target = document.getElementById(targetId);
          const expanded = btn.getAttribute('aria-expanded') === 'true';

          btn.setAttribute('aria-expanded', !expanded);
          btn.querySelector('.collapse-arrow').classList.toggle('rotate-180', !expanded);
          target.classList.toggle('hidden', expanded);

          // üëâ L∆∞u tr·∫°ng th√°i ngay khi toggle
          localStorage.setItem(`sidebar-${targetId}`, (!expanded).toString());
        });
      });

      // --- 3Ô∏è‚É£ T·ª± ƒë·ªông m·ªü nh√≥m ch·ª©a m·ª•c ƒëang active ---
      const activeLink = document.querySelector('a.bg-gradient-to-r');
      if (activeLink) {
        const parentGroup = activeLink.closest('div[id^="group-"]');
        if (parentGroup) {
          const btn = document.querySelector(`button[data-target="${parentGroup.id}"]`);
          if (btn) {
            parentGroup.classList.remove('hidden');
            btn.setAttribute('aria-expanded', 'true');
            btn.querySelector('.collapse-arrow').classList.add('rotate-180');
            localStorage.setItem(`sidebar-${parentGroup.id}`, 'true');
          }
        }
      }

      // üß† Gi·ªØ tr·∫°ng th√°i sidebar khi ƒëi·ªÅu h∆∞·ªõng link
      document.addEventListener("click", function(e) {
        const link = e.target.closest("a[href]");
        if (link) {
          document.querySelectorAll(".collapse-btn").forEach(btn => {
            const targetId = btn.dataset.target;
            const expanded = btn.getAttribute("aria-expanded") === "true";
            localStorage.setItem(`sidebar-${targetId}`, expanded.toString());
          });
        }
      });

      // üõ†Ô∏è FIX: NgƒÉn click link con l√†m s·∫≠p nh√≥m cha (ƒë·∫∑c bi·ªát m·ª•c ti√™u t√†i ch√≠nh)
      document.querySelectorAll('div[id^="group-"] a').forEach(link => {
        link.addEventListener('click', e => e.stopPropagation());
      });
    });
  </script>




