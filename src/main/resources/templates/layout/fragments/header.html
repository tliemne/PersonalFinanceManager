<!-- templates/layout/fragments/header.html -->
<div th:fragment="header"
     class="flex justify-between items-center bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 py-3 shadow-sm transition-all duration-300">

  <!-- Tiêu đề trang -->
  <h1 class="text-xl font-semibold text-gray-800 dark:text-gray-100 tracking-tight flex items-center gap-2">
    <i class="fas fa-chart-pie text-indigo-500"></i>
    <span th:text="${pageTitle}">Dashboard</span>
  </h1>

  <!-- Khu vực bên phải -->
  <div class="flex items-center gap-4">

    <!-- Nút chuyển theme -->
    <button id="themeToggle" class="relative text-gray-600 dark:text-gray-300 hover:text-indigo-500 transition">
      <!-- Sun -->
      <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 block dark:hidden transform transition-transform duration-500 rotate-0"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M12 3v1m0 16v1m8.66-11.66-.707.707M4.047 18.953l.707-.707M21 12h1M2 12H1m16.66 7.66-.707-.707M4.047 5.047l.707.707M12 8a4 4 0 100 8 4 4 0 000-8z" />
      </svg>
      <!-- Moon -->
      <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6 hidden dark:block transform transition-transform duration-500 rotate-180"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" />
      </svg>
    </button>

    <!-- Dropdown User -->
    <div class="relative" x-data="{ open: false }">
      <button @click="open = !open"
              class="flex items-center gap-2 focus:outline-none hover:bg-gray-100 dark:hover:bg-gray-800 px-2 py-1 rounded-lg transition">
        <img th:src="${user?.avatarUrl != null} ? ${user.avatarUrl} : @{/images/default-avatar.png}"
             alt="avatar" class="h-8 w-8 rounded-full object-cover border border-gray-300" />
        <span class="text-gray-800 dark:text-gray-200 font-medium text-sm"
              th:text="${user?.fullName ?: user?.username ?: 'Người dùng'}">Liêm</span>
        <i class="fas fa-chevron-down text-xs text-gray-500"></i>
      </button>

      <!-- Menu dropdown -->
      <div x-show="open"
           @click.away="open = false"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-150"
           x-transition:leave-start="opacity-100 scale-100"
           x-transition:leave-end="opacity-0 scale-95"
           class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-xl shadow-lg overflow-hidden z-50">

        <a th:href="@{/dashboard/profile}"
           class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          <i class="fas fa-user-circle w-4"></i> Hồ sơ cá nhân
        </a>

        <a th:href="@{/dashboard/settings}"
           class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          <i class="fas fa-cog w-4"></i> Cài đặt
        </a>

        <a th:href="@{/dashboard/security}"
           class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
          <i class="fas fa-lock w-4"></i> Bảo mật
        </a>

        <div class="border-t border-gray-200 dark:border-gray-700"></div>

        <a href="/logout"
           class="flex items-center gap-2 px-4 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-gray-700 transition">
          <i class="fas fa-sign-out-alt w-4"></i> Đăng xuất
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Script -->
<script>
  // Theme toggle
  const themeToggle = document.getElementById('themeToggle');
  const html = document.documentElement;
  const sunIcon = document.getElementById('sunIcon');
  const moonIcon = document.getElementById('moonIcon');

  themeToggle.addEventListener('click', () => {
    html.classList.toggle('dark');
    const isDark = html.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');

    // Animation
    if (isDark) {
      sunIcon.classList.add('rotate-180');
      moonIcon.classList.remove('rotate-180');
    } else {
      moonIcon.classList.add('rotate-180');
      sunIcon.classList.remove('rotate-180');
    }
  });

  if (localStorage.getItem('theme') === 'dark') {
    html.classList.add('dark');
  }
</script>
